.box.box-primary
  .box-body
    = simple_form_for(@customer) do |f|
      = f.error_notification
      - @customer.errors.each do |attr, msg|
        .alert.alert-danger
          <button type="button" class="close" data-dismiss="alert">×</button>
          = "#{attr} #{msg}" if @customer.errors[attr].first == msg
      %a{:href => "#", "data-toggle" => "modal", "data-target" => "#avatar", class: 'thumbnail', title: 'Change'}
        %span{"data-toggle" => browser.device.mobile? ? "" : "tooltip", :title => "Change"}
          - unless @customer.avatar.blank?
            = image_tag(@customer.avatar.url, id: 'profile_image', class: 'profile-user-img img-responsive')
          - else
            = image_tag('avatar_holder_image.png',  id: 'profile_image', class: 'profile-user-img img-responsive')
      
      .form-inputs
        #avatar.modal.fade.in
          .modal-dialog.modal-sm{:role => "document"}
            .modal-content
              .modal-header
                New Avatar image
                %button.close{"aria-label" => "Close", "data-dismiss" => "modal", :type => "button"}
                  %span{"aria-hidden" => "true"} ×
              .modal-body
                -#
                  - unless browser.device.mobile?
                    %button.btn.btn-default.btn-block{:type => "button"}
                      %i.fa.fa-camera
                      Take Photo with Camera
                    %hr
                = f.input :avatar, as: :file, input_html: {onchange: "PreviewImage();"}, label: false
                = f.input :avatar_cache, as: :hidden
              .modal-footer
                %button.btn.btn-default{"data-dismiss" => "modal", :type => "button"} Done
            / /.modal-content
          / /.modal-dialog
        / /.modal
        - if current_user.administrator?
          = f.input :CompanyNumber, :as => :hidden, :input_html => { :value => "#{@customer.new_record? ? current_user.company.id : @customer.CompanyNumber}" }
          = f.input :LangID, :as => :hidden, :input_html => { :value => 1 }
          = f.input :NameF, label: 'First Name', required: true
          = f.input :NameL, label: 'Last Name', required: true
          = f.input :PhoneMobile, label: 'Phone', required: true
          = f.input :Email, label: 'Email'  , required: true
          = f.input :Registration_Source, label: 'Payee ID' unless current_user.caddy_admin?
          = f.input :GroupID, collection: Group.selections_by_user_role(current_user), selected: @customer.new_record? ? params[:group_id] : @customer.GroupID, as: :select, label: "Type", prompt: "Select type", required: true
          -#
            - unless current_user.caddy_admin?
              = f.input :GroupID, :as => :hidden, :input_html => { :value => "#{@customer.new_record? ? 18 : @customer.GroupID}" }
            - else
              = f.input :GroupID, collection: Group.selections_by_user_role(current_user), selected: @customer.GroupID, as: :select, label: "Type", prompt: "Select type", required: true
          = f.input :Active, as: :boolean, inline_label: 'Active'
          = f.simple_fields_for :accounts do |account_form|
            - if account_form.object.new_record?
              = account_form.input :CustomerID, :as => :hidden, :input_html => { :value => @customer.id }
              = account_form.input :CompanyNumber, :as => :hidden, :input_html => { :value => current_user.company.id }
              = account_form.input :Balance, :as => :hidden, :input_html => { :value => 0 }
              = account_form.input :MinBalance, :as => :hidden, :input_html => { :value => 0}
              = account_form.input :ActTypeID, :as => :hidden, :input_html => { :value => 6 }
              = account_form.input :AbleToDelete, :as => :hidden, :input_html => { :value => 0 }
            =# account_form.collection_check_boxes(:event_ids, current_user.company.events.now_open, :id, :title)
            -#
              .row
                .col-xs-12.col-sm-6
                  %label.control-label 
                    %strong Events
                  = account_form.collection_check_boxes(:event_ids, account_form.object.new_record? ? current_user.company.events.now_open : current_user.company.events.now_open.accounts_do_not_expire, :id, :title) do |account_field|
                    = account_field.label(class:"label-checkbox") { account_field.check_box + ' ' + account_field.text }
          
      .form-actions
        = link_to 'Cancel', :back, class: 'btn btn-default'
        = f.button :submit, 'Save'

:javascript
  $('[data-toggle="tooltip"]').tooltip()

  function PreviewImage() {
    var oFReader = new FileReader();
    oFReader.readAsDataURL(document.getElementById("customer_avatar").files[0]);

    oFReader.onload = function (oFREvent) {
      document.getElementById("profile_image").src = oFREvent.target.result;
    };
  };