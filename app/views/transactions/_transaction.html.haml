- to_customer = transaction.to_account_customer
- from_customer = transaction.from_account_customer
%tr{class: transaction.reversal? ? 'table-danger' : transaction.error? ? 'table-warning' : ''}
  %th{:scope => "row"}= link_to transaction.id, transaction
  %td
    =# transaction.date_time.in_time_zone(current_user.time_zone).strftime("%-m/%-d/%y")
    = transaction.date_time.strftime("%-m/%-d/%y")
  %td
    - unless to_customer.blank?
      = link_to to_customer.identity, customer_path(to_customer, account_id: transaction.to_acct_id) unless transaction.to_account.blank?
    - else
      = transaction.to_account.company.name unless transaction.to_account.blank?
  %td
    - unless from_customer.blank?
      = link_to from_customer.identity, customer_path(from_customer, account_id: transaction.from_acct_id) unless transaction.from_account.blank?
    - else
      = transaction.from_account.company.name unless transaction.from_account.blank?
  %td= transaction.event.blank? ? 'N/A' : transaction.event.title
  %td= "#{transaction.ChpFee.blank? ? number_to_currency(0) : number_to_currency(transaction.ChpFee)}" 
  %td= "#{transaction.amt_auth.blank? ? number_to_currency(0) : number_to_currency(transaction.amt_auth)}"
  %td
    - unless to_customer.blank? or transaction.to_account.balance.blank? or transaction.to_account.balance.zero?
      - if current_user.admin? or (current_user.collaborator? and current_user.devices.blank?) or current_user.super?
        %a.btn.btn-default{href: barcode_customer_path(to_customer.id, amount: transaction.amt_auth, transaction_id: transaction.id)}
          %i.fa.fa-print
      - else
        - if current_user.devices.count > 1
          .dropdown
            %button.btn.btn-default.dropdown-toggle{"data-toggle" => "dropdown", :type => "button"}
              %i.fa.fa-print
              %span.caret
            %ul.dropdown-menu
              - current_user.devices.each do |device|
                %li
                  %a{href: barcode_customer_path(to_customer.id, amount: transaction.amt_auth, device_id: device.id, transaction_id: transaction.id)}
                    = device.description
        - elsif current_user.devices.count == 1
          %a.btn.btn-default{href: barcode_customer_path(to_customer.id, amount: transaction.amt_auth, device_id: current_user.devices.first.id, transaction_id: transaction.id)}
            %i.fa.fa-print
        - else
          %a.btn.btn-default{href: barcode_customer_path(to_customer.id, amount: transaction.amt_auth, transaction_id: transaction.id)}
            %i.fa.fa-print